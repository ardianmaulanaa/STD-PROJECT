#include <iostream>
#include "header_MLL.h"
using namespace std;

// #Greetings
void welcomePage(){
    cout << endl<< "===================================================" << endl;
    cout << "      SELAMAT DATANG DI MANAJEMEN KOLEKSI    " << endl;
    cout << "                GAME                  " << endl;
    cout << "===================================================" << endl;
};

void fiturPage(){
    cout << "              MENU FITUR                " << endl;
    cout << "===================================================" << endl;
    cout << "1. Input Data" << endl;
    cout << "2. Lihat List Game & Achievement" << endl;
    cout << "3. Hapus Data" << endl;
    cout << "4. Update Data" << endl;
    cout << "5. Cari Data Game" << endl;
    cout << "6. Urutkan Game" << endl;
    cout << "7. Total Game" << endl;
    cout << "8. Min / Max Achievement" << endl;
    cout << "===================================================" << endl;
};

void closeCMD(){
    cout << endl<< "===================================================" << endl;
    cout << "      TERIMAKASIH SUDAH MENGAKSES MANAJEMEN KOLEKSI    " << endl;
    cout << "                GAME                  " << endl;
    cout << "===================================================" << endl<<endl;

};

// Eksekusi?

void executeOpsi(ListGame &L, int opsi) {

    string id, title, genre, platform;
    string oldTitle, newTitle;
    string achievementName, oldName, newName;

    if (opsi == 1) { //Input Data (Game / Achievement)
        int subOpsi;
        cout << "\n=== MENU CREATE ===\n";
        cout << "1. Tambah Game\n";
        cout << "2. Tambah Achievement\n";
        cout << "Pilih: ";
        cin >> subOpsi;

        if (subOpsi == 1) {
            cout << "ID Game   : "; cin >> id;
            cout << "Judul     : "; cin >> title;
            cout << "Genre     : "; cin >> genre;
            cout << "Platform  : "; cin >> platform;

            if (!isGameExists(L, title)) {
                addGame(L, createElmGame(id, title, genre, platform));
                cout << "Game berhasil ditambahkan\n";
            } else {
                cout << "Game sudah ada\n";
            }
        } else if (subOpsi == 2) {
            cout << "Judul Game       : "; cin >> title;
            cout << "Nama Achievement : "; cin >> achievementName;

            adrGame p = L.first;
            if (p->info.title == title) {
                addAchievement(p, createElmAchievement(achievementName));
                cout << "Achievement berhasil ditambahkan\n";
            } else {
                cout << "Game tidak ditemukan\n";
            }
        } else {
            cout << "Pilihan tidak valid\n";
        }
    }











    else if (opsi == 2) { //Lihat List Game & Achievement
            displayListGame(L);
    }












    else if (opsi == 3) { //Hapus Data (Game / Achievement)
        int subOpsi;
        cout << "\n=== MENU DELETE ===\n";
        cout << "1. Hapus Game\n";
        cout << "2. Hapus Achievement\n";
        cout << "Pilih: ";
        cin >> subOpsi;

        if (subOpsi == 1) {
            cout << "Judul     : "; cin >> title;
            deleteGameByTitle(L, title);
            cout << "Game dihapus\n";
        } else if (subOpsi == 2) {
            cout << "Nama Achievement : "; cin >> achievementName;
            deleteAchievementsByAchievementName(L, achievementName);
            cout << "Achievement dihapus\n";
        } else {
            cout << "Pilihan tidak valid\n";
        }
    }











    else if (opsi == 4) { //Update Data (Game / Nama Achievement)
        int subOpsi;
        cout << "\n=== MENU UPDATE ===\n";
        cout << "1. Update Data \n";
        cout << "2. Update Nama Achievement\n";
        cout << "Pilih: ";
        cin >> subOpsi;

        if (subOpsi == 1) {
            updateGame(L);
        } else if (subOpsi == 2) {
            cout << "Judul Game     : "; cin >> title;
            cout << "Nama Lama ACV  : "; cin >> oldName;
            cout << "Nama Baru ACV  : "; cin >> newName;

            updateAchievementName(L, title, oldName, newName);
            cout << "Nama achievement diperbarui\n";
        } else {
            cout << "Pilihan tidak valid\n";
        }
    }







    if (opsi == 5) { //Cari Game
        int subOpsi;
        cout << "\n=== MENU SEARCH ===\n";
        cout << "1. Judul\n";
        cout << "2. Genre\n";
        cout << "3. Platform\n";
        cout << "4. Achievement Game\n";
        cout << "Pilih: ";
        cin >> subOpsi;

        if (subOpsi == 1) {
            string title;
            cout << "Masukkan judul game: ";
            cin >> title;

            adrGame p = searchGameByTitle(L, title);
            if (p != nullptr) {
                displayGame(p);
            } else {
                cout << "Game tidak ditemukan\n";
            }

        } else if (subOpsi == 2) {
            string genre;
            cout << "Masukkan genre: ";
            cin >> genre;
            searchGameByGenre(L, genre);

        } else if (subOpsi == 3) {
            string platform;
            cout << "Masukkan platform: ";
            cin >> platform;
            searchGameByPlatform(L, platform);

        } else if (subOpsi == 4) {
            string title;
            cout << "Masukkan judul game: ";
            cin >> title;

            adrGame p = searchGameByTitle(L, title);
            if (p != nullptr) {
                searchAchievementByTitle(p);
            } else {
                cout << "Game tidak ditemukan\n";
            }

        } else {
            cout << "Pilihan tidak valid\n";
        }
    }








    else if (opsi == 6) {//Urutkan Game berdasarkan (Judul Game (A-Z) / Jumlah Achievement
        int subOpsi;
        cout << "\n=== MENU SORTING ===\n";
        cout << "Berdasarkan\n";
        cout << "1. Judul Game (A-Z)\n";
        cout << "2. Jumlah Achievement\n";
        cout << "Pilih: ";
        cin >> subOpsi;

        if (subOpsi == 1) {
            sortGameByTitle(L);
            cout << "Game berhasil diurutkan berdasarkan judul\n";
        } else if (subOpsi == 2) {
            sortGameByAchievementCount(L);
            cout << "Game berhasil diurutkan berdasarkan jumlah achievement\n";
        } else {
            cout << "Pilihan tidak valid\n";
        }
    }












    else if (opsi == 7) { //Total Game berdasarkan (Genre / Platform / Achievement)"
        int subOpsi;
        cout << "\n=== MENU COUNT ===\n";
        cout << "Berdasarkan\n";
        cout << "1. Genre\n";
        cout << "2. Platform\n";
        cout << "2. Achievement\n";
        cout << "Pilih: ";
        cin >> subOpsi;

        if (subOpsi == 1) {
            cout << "Masukkan genre: ";
            cin >> genre;
            cout << "Total game: " << countGameByGenre(L, genre) << endl;
        } else if (subOpsi == 2) {
            cout << "Masukkan platform: ";
            cin >> platform;
            cout << "Total game: " << countGameByPlatform(L, platform) << endl;
        } else if (subOpsi == 3) {
            string title;
            cout << "Masukkan judul game: ";
            cin >> title;

            adrGame p = L.first;
            while (p != nullptr && p->info.title != title) {
                p = p->next;
            }

            if (p != nullptr) {
                cout << "Total achievement: "
                     << countAchievement(p->firstACV) << endl;
            } else {
                cout << "Game tidak ditemukan\n";
            }
        } else {
            cout << "Game tidak ditemukan\n";
        }
    }











    else if (opsi == 8) {//Min / Max Achievement
        int pilih;
        cout << "\n=== MENU MIN / MAX ===\n";
        cout << "1. Game dengan Achievement Terbanyak\n";
        cout << "2. Game dengan Achievement Tersedikit\n";
        cout << "Pilihan: ";
        cin >> pilih;

        if (pilih == 1) {
            adrGame p = getGameWithMaxAchievement(L);
            if (p != nullptr) {
                cout << "Game dengan achievement terbanyak: "
                     << p->info.title << endl;
            } else {
                cout << "Belum memasukkan Data Game\n";
            }
        } else if (pilih == 2) {
            adrGame p = getGameWithMinAchievement(L);
            if (p != nullptr) {
                cout << "Game dengan achievement tersedikit: "
                     << p->info.title << endl;
            } else {
                cout << "Belum memasukkan Data Game\n";
            }
        } else {
            cout << "Pilihan tidak valid\n";
        }
    }






    cout << "\nMasukkan angka apa saja lalu ENTER untuk keluar dari fitur: ";
    cin >> opsi;
}












// Masukkan Data Game
// Create
void createListGame(ListGame &L) {
    L.first = nullptr;
    L.last = nullptr;
}
bool isEmptyGame(ListGame L) {
    return (L.first == nullptr && L.last == nullptr);
}
bool isEmptyAchievement(adrGame p) {
    return (p->firstACV == nullptr);
}

bool isGameExists(ListGame L, string judulGame) {
    adrGame p = L.first;
    while(p!= nullptr){
        if(p->info.title == judulGame){
            return true;
        }
        p=p->next;
    }
    return false;
};

adrGame createElmGame(string GameID, string title, string genre, string platform) {
    adrGame p = new elmGame;

    p->info.GameID = GameID;
    p->info.title = title;
    p->info.genre = genre;
    p->info.platform = platform;
    p->firstACV = nullptr;
    p->next = nullptr;
    p->prev = nullptr;

    return p;

}

adrAchievement createElmAchievement(string achievementName) {
    adrAchievement q = new elmAchievement;

    q->info.achievementName = achievementName;

    q->next = nullptr;
    q->prev = nullptr;

    return q;
}












//Add
// Masukkan data Game dan Achievement
void addGame(ListGame &L, adrGame p) {
    if(isEmptyGame(L)) {
        L.first = p;
        L.last = p;
        p->next = nullptr;
        p->prev = nullptr;
    } else {
        L.last->next = p;
        p->prev = L.last;
        p->next = nullptr;
        p->prev = nullptr;
        L.last = p;
    }
    p->next = nullptr;
}

void addAchievement(adrGame &q, adrAchievement p) {
    if (isEmptyAchievement(q)) {
        q->firstACV = p;
        p->next = nullptr;
        p->prev = nullptr;
    } else {
        adrAchievement x = q->firstACV;
        while (x->next != nullptr) {
            x = x->next;
        }
        x->next = p;
        p->prev = x;
        p->next = nullptr;
    }
}
//end input data Game dan Achievement















// Display

// Lihat List Game & Achievement

void displayListGame(ListGame L) {
    adrGame p = L.first;
    cout << endl;
    cout << "===================[LIST GAME]====================" << endl;
    while (p != nullptr) {
        cout << "ID Game                : ";
        cout << p->info.GameID << endl;
        cout << "Judul Game             : ";
        cout << p->info.title << endl;
        cout << "Genre                  : ";
        cout << p->info.genre << endl;
        cout << "Platform               : ";
        cout << p->info.platform << endl;


        adrAchievement q = p->firstACV;
        if (q == nullptr) {
            cout << "Achievements           : (Belum ada achievement)" << endl;
        } else {
            cout << "Achievements           : " << endl;
            while (q != nullptr) {
                cout << "   - " << q->info.achievementName << endl;
                q = q->next;
            }
        }

        p = p->next;
        cout << endl;
    }
}

// End Display














// Delete

// Hapus data Game

void deleteGameByTitle(ListGame &L, string title) {

    if (!isEmptyGame(L)) {
        adrGame p = searchGameByTitle(L, title);
        if (p != nullptr) {

            if (p == L.first && p == L.last) {
                L.first = nullptr;
                L.last  = nullptr;
            }
            else if (p == L.first) {
                L.first = p->next;
                L.first->prev = nullptr;
            }
            else if (p == L.last) {
                L.last = p->prev;
                L.last->next = nullptr;
            }
            else {
                p->prev->next = p->next;
                p->next->prev = p->prev;
            }

            p->next = nullptr;
            p->prev = nullptr;
        }
    }
}

// Hapus data Achievement

void deleteAchievementsByAchievementName(ListGame &L, string achievementName) {

    if (!isEmptyGame(L)) {

        adrGame p = L.first;

        while (p != nullptr) {

            adrAchievement q = p->firstACV;

            while (q != nullptr) {
                if (q->info.achievementName == achievementName) {
                    adrAchievement nextNode = q->next;
                    if (q == p->firstACV) {
                        p->firstACV = q->next;
                        if (p->firstACV != nullptr) {
                            p->firstACV->prev = nullptr;
                        }
                    }
                    else if (q->next == nullptr) {
                        q->prev->next = nullptr;
                    }
                    else {
                        q->prev->next = q->next;
                        q->next->prev = q->prev;
                    }

                    q->next = nullptr;
                    q->prev = nullptr;

                    q = nextNode;
                }
                else {
                    q = q->next;
                }
            }
            p = p->next;
        }
    }
}

// End Delete







// Update

// Update Data Game

void updateGame(ListGame &L) {
    string oldTitle;
    cout << "Masukkan judul game yang akan diupdate: ";
    cin >> oldTitle;

    adrGame p = L.first;
    while (p != nullptr && p->info.title != oldTitle) {
        p = p->next;
    }

    if (p == nullptr) {
        cout << "Game tidak ditemukan\n";
    } else {

        int subOpsi;
        cout << "Pilih data yang ingin diupdate:\n";
        cout << "1. ID Game\n";
        cout << "2. Judul Game\n";
        cout << "3. Genre\n";
        cout << "4. Platform\n";
        cout << "5. Update Semua\n";
        cout << "Pilihan: ";
        cin >> subOpsi;

        if (subOpsi== 1) {
            cout << "ID baru: ";
            cin >> p->info.GameID;
        } else if (subOpsi == 2) {
            cout << "Judul baru: ";
            cin >> p->info.title;
        } else if (subOpsi == 3) {
            cout << "Genre baru: ";
            cin >> p->info.genre;
        } else if (subOpsi == 4) {
            cout << "Platform baru: ";
            cin >> p->info.platform;
        } else if (subOpsi == 5) {
            cout << "ID baru: ";
            cin >> p->info.GameID;
            cout << "Judul baru: ";
            cin >> p->info.title;
            cout << "Genre baru: ";
            cin >> p->info.genre;
            cout << "Platform baru: ";
            cin >> p->info.platform;
        } else {
            cout << "Pilihan tidak valid\n";
        }
    }

}

// Update Nama Achievement

void updateAchievementName(ListGame &L, string &title, string &oldName, string &newName) {
  adrGame p = L.first;

    while (p != nullptr) {
        if (p->info.title == title) {
            adrAchievement q = p->firstACV;
            while (q != nullptr) {
                if (q->info.achievementName == oldName) {
                    q->info.achievementName = newName;
                }
                q = q->next;
            }
        }
        p = p->next;
    }
}

// End Update








// Search

// Cari List Game

adrGame searchGameByTitle(ListGame L, string title) {
    adrGame p = L.first;

    while (p != nullptr) {
        if (p->info.title == title) {
            return p;
        }
        p = p->next;
    }
    return nullptr;
}

// Cari Game apa saja yang ada di genre tersebut

void searchGameByGenre(ListGame L, string genre) {
    adrGame p = L.first;
    bool ketemu = false;

    while (p != nullptr) {
        if (p->info.genre == genre) {
            cout << "- " << p->info.title << endl;
            ketemu = true;
        }
        p = p->next;
    }
    if (!ketemu) {
        cout << "Tidak ada game di genre tersebut\n";
    }
}

// Cari Game apa saja yang ada di platform tersebut

void searchGameByPlatform(ListGame L, string platform) {
    adrGame p = L.first;
    bool ketemu = false;

    while (p != nullptr) {
        if (p->info.platform == platform) {
            cout << "- " << p->info.title << endl;
            ketemu = true;
        }
        p = p->next;
    }
    if (!ketemu) {
        cout << "Tidak ada game di platform tersebut\n";
    }
}

// Cari Achievement
void searchAchievementByTitle(adrGame p) {
    if (p == nullptr) {
        cout << "Game tidak ditemukan\n";
    }

    if (p->firstACV == nullptr) {
        cout << "Game belum memiliki achievement\n";
    }

    adrAchievement q = p->firstACV;
    cout << "Daftar Achievement:\n";

    while (q != nullptr) {
        cout << "- " << q->info.achievementName << endl;
        q = q->next;
    }
}


// Display Hasil Search

void displayGame(adrGame p) {
    cout << "ID       : " << p->info.GameID << endl;
    cout << "Judul    : " << p->info.title << endl;
    cout << "Genre    : " << p->info.genre << endl;
    cout << "Platform : " << p->info.platform << endl;
}


// End Search








//Sorting

// Urutkan Judul Game (A-Z)

void sortGameByTitle(ListGame &L) {
    adrGame p, t;

    p = L.first;
    while (p != nullptr) {
        t = p->next;
        while (t != nullptr) {
            if (p->info.title > t->info.title) {

                Game tempGame = p->info;
                adrAchievement tempACV = p->firstACV;

                p->info = t->info;
                p->firstACV = t->firstACV;

                t->info = tempGame;
                t->firstACV = tempACV;
            }
            t = t->next;
        }
        p = p->next;
    }
}

// Urutkan Game berdasarkan Jumlah Achievement

void sortGameByAchievementCount(ListGame &L) {
    adrGame p, a;

    p = L.first;
    while (p != nullptr) {
        a = p->next;

        while (a != nullptr) {
            if (countAchievement(p->firstACV) < countAchievement(a->firstACV)) {

                Game tempGame = p->info;
                adrAchievement tempACV = p->firstACV;

                p->info = a->info;
                p->firstACV = a->firstACV;

                a->info = tempGame;
                a->firstACV = tempACV;
            }
            a = a->next;
        }
        p = p->next;
    }
}

// End Sorting






// Count

// Total Game Berdasarkan Genre

int countGameByGenre(ListGame L, string genre) {
    int count = 0;
    adrGame p = L.first;

    while (p != nullptr) {
        if (p->info.genre == genre) {
            count++;
        }
        p = p->next;
    }
    return count;
}

//Total Game Berdasarkan Platform
int countGameByPlatform(ListGame L, string platform) {
    int count = 0;
    adrGame p = L.first;

    while (p != nullptr) {
        if (p->info.platform == platform) {
            count++;
        }
        p = p->next;
    }
    return count;
}


// Total Achievement

int countAchievement(adrAchievement firstACV) {
    int count = 0;
    adrAchievement p = firstACV;

    while(p != nullptr) {
        count++;
        p=p->next;
    }
    return count;
}


// End Count







// Get atau MIN/MAX

// Game dengan Achievment Terbanyak

adrGame getGameWithMaxAchievement(ListGame L) {
    if (isEmptyGame(L)) {
        return nullptr;
    }
    adrGame p = L.first;
    adrGame maxGame = p;
    int maxCount = countAchievement(p->firstACV);

    while (p != nullptr) {
        int currentCount = countAchievement(p->firstACV);
        if (currentCount > maxCount) {
                maxCount = currentCount;
                maxGame = p;
            }
        p=p->next;

        }
    return maxGame;
}

// Game dengan Achievment Tersedikit

adrGame getGameWithMinAchievement(ListGame L) {
    if (isEmptyGame(L)) {
        return nullptr;
    }
    adrGame p = L.first;
    adrGame minGame = p;
    int minCount = countAchievement(p->firstACV);

    while (p != nullptr) {
        int currentCount = countAchievement(p->firstACV);
        if (currentCount < minCount) {
                minCount = currentCount;
                minGame = p;
            }
        p=p->next;

        }
    return minGame;
}

// End Min/Max





//Utility

void clearScreen() {
    system("cls"); //Hanya bisa untuk windows
}

// End Ultility





